<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubbles Kitpvp | Home</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <nav>
    <!-- LEFT side wrapper -->
    <div class="nav-left">
      <img src="logo.png" alt="Server Logo" class="logo" />
    </div>

    <!-- CENTER nav links -->
    <ul>
      <li><a href="#home">Home</a></li>
      <li><a href="#reviews">Reviews</a></li>
      <li><a href="#join">Join</a></li>
      <li><a href="#discord">Discord</a></li>
      <li><a href="#donate">Donate</a></li>
    </ul>

    <!-- RIGHT side: Discord Login UI -->
    <div id="discord-login" style="position: absolute; top: 20px; right: 20px;">
      <a href="#" id="login-btn" class="login-btn">Log&nbsp;in&nbsp;with&nbsp;Discord</a>
    </div>
  </nav>
</header>

<section id="home" class="hero">
  <h1>Welcome to Bubbles Kitpvp</h1>
  <p>A Minecraft server focused on community, creativity, and fun.</p>
  <a href="#join" class="btn">Join Now</a>
</section>

<section id="reviews">
  <h2>Player Reviews</h2>
  <div id="quoteBox" class="quote-box">Loading reviews...</div>
</section>

<section id="join">
  <h2>Join the Adventure</h2>
  <p>Server IP: <strong>play.bubblespvp.net</strong></p>
  <p>Port: <strong>19132</strong></p>
  <a href="#discord" class="btn">Join Our Discord</a>
</section>

<section id="discord">
  <h2>Join Our Discord Community</h2>
  <div class="discord-box">
    <h3>Fully Integrated & Reliable Platform</h3>
    <ul>
      <li>âœ“ Meet other Bubbles Kitpvp Members</li>
      <li>âœ“ Real-time Realm chat integration</li>
      <li>âœ“ Instant update notifications</li>
      <li>âœ“ Help shape our growing community</li>
      <li>âœ“ Priority technical support</li>
      <li>âœ“ Exclusive announcement channel</li>
      <li>âœ“ Community showcase opportunities</li>
    </ul>
    <p>&amp; many more benefits!</p>
    <a class="discord-btn" href="https://discord.gg/bubbleskitpvp" target="_blank">ðŸ”— Join Now</a>
    <div class="reconnect">Already a member? <a href="https://discord.gg/bubbleskitpvp">Click to reconnect</a></div>
  </div>
</section>

<footer>
  <p>&copy; 2025 BubblesKitPvp. All rights reserved.</p>
</footer>

<script>
  // Quote Rotation
  const quoteBox = document.getElementById("quoteBox");
  let quotes = [];
  let currentQuote = 0;

  async function loadQuotes() {
    try {
      const response = await fetch("quotes.json");
      if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
      quotes = await response.json();
      showNextQuote();
      setInterval(showNextQuote, 4000);
    } catch (error) {
      console.error("Failed to load quotes:", error);
      quoteBox.textContent = "Failed to load reviews.";
    }
  }

  function showNextQuote() {
    if (quotes.length === 0) return;
    quoteBox.classList.add("fade-out");
    setTimeout(() => {
      const [user, quote, rating] = quotes[currentQuote];
      quoteBox.innerHTML = `
        <q>${quote}</q>
        <div class="source">â€“ ${user} (${rating}/10)</div>
      `;
      quoteBox.classList.remove("fade-out");
      currentQuote = (currentQuote + 1) % quotes.length;
    }, 500);
  }

  loadQuotes();

  // --- Discord Login ---
  const clientId = "1374928268901220482";
  const redirectUri = "https://bubblestogo.github.io";

  function loginWithDiscord() {
    const authUrl = `https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=token&scope=identify`;
    window.location.href = authUrl;
  }

  function getTokenFromHash() {
    const match = window.location.hash.match(/access_token=([^&]*)/);
    return match ? match[1] : null;
  }

  async function fetchDiscordUser(token) {
    const res = await fetch("https://discord.com/api/users/@me", {
      headers: { Authorization: `Bearer ${token}` }
    });
    if (!res.ok) throw new Error("Failed to fetch user");
    return await res.json();
  }

  function showUser(user) {
    const discordLoginDiv = document.getElementById("discord-login");
    discordLoginDiv.innerHTML = `
      <div class="user-info" style="display:flex; align-items:center; gap:10px; color:#5865F2; font-weight:600;">
        <img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" alt="Avatar" style="width:32px; height:32px; border-radius:50%; border: 2px solid #5865F2;" />
        <span>${user.username}#${user.discriminator}</span>
        <button id="logout-btn" style="background:#5865F2; color:#fff; border:none; padding:5px 10px; border-radius:6px; cursor:pointer;">Logout</button>
      </div>
    `;
    document.getElementById("logout-btn").addEventListener("click", () => {
      localStorage.removeItem("discordUser");
      location.reload();
    });
  }

  const token = getTokenFromHash();
  if (token) {
    fetchDiscordUser(token).then(user => {
      localStorage.setItem("discordUser", JSON.stringify(user));
      showUser(user);
      history.replaceState({}, document.title, window.location.pathname);
    }).catch(() => alert("Discord login failed"));
  } else if (localStorage.getItem("discordUser")) {
    showUser(JSON.parse(localStorage.getItem("discordUser")));
  } else {
    document.getElementById("login-btn").addEventListener("click", e => {
      e.preventDefault();
      loginWithDiscord();
    });
  }
</script>
</body>
</html>
